import os
import win32com.client as win32

attachment_directory = r"C:\VS Code\Attachment\Akron.xlsx"
kpi_directory = r"C:\VS Code\KPI\Akron.jpg"

def create_customized_message(to, cc, bcc, owning_office):
    recipients = to.split(",")
    cc_recipients = cc.split(",")
    bcc_recipients = bcc.split(",")

    subject = "Data Quality Management Report : " + owning_office

    attachment_path = attachment_directory
    kpi_path = kpi_directory 

    body = """<div style="font-family: Calibri, sans-serif; font-size: 12pt;">
    Hello Team,<br><br>

"""
       

    return (recipients, cc_recipients, bcc_recipients, subject, body, attachment_path, kpi_path)

for index, row in dataset.iterrows():
    #print(row)
    (recipients, cc_recipients,bcc_recipients, subject, body, attachment_path, picture_path) = create_customized_message(row["TO"], row["CC"], row["BCC"], row["Owning Office"])
    #print(msg_parameters)
    send_email_with_attachment_and_picture(recipients, cc_recipients,bcc_recipients, subject, body, attachment_path, picture_path)
    break

    def send_email_with_attachment_and_picture(recipients, cc_recipients,bcc_recipients, subject, body, attachment_path, picture_path):
        outlook = win32.Dispatch('Outlook.Application')
        mail = outlook.CreateItem(0)
        mail.SentOnBehalfOfName = "NCS_Data_Quality@firstam.com"
        mail.To = ";".join(recipients)
        mail.CC = ";".join(cc_recipients) if cc_recipients else ""
        mail.bcc = ";".join(recipients)
        mail.Subject = subject
        mail.HTMLBody = f"""<img src="{picture_path}" alt="Embedded Picture" style="width:300px;height:200px;"><p>{body}</p>"""

        if attachment_path:
            mail.Attachments.Add(attachment_path)

    
        mail.Display()
    #mail.Send()
    
