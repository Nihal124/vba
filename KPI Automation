import os
import time
import win32com.client

# create an instance of Excel
excel = win32com.client.Dispatch("Excel.Application")

# open the workbook and select the worksheet
wb = excel.Workbooks.Open(r"C:\VS Code\DQM KPI.xlsx")
ws = wb.Worksheets("Sheet1")

# get the dimensions of the worksheet
ws_width = ws.Columns("A:Z").Width
ws_height = ws.Rows("1:50").Height

# create a bitmap of the worksheet
bitmap = win32com.client.Dispatch("WIA.ImageFile")
bitmap = bitmap.FromBitmap(excel.Application.ActiveWindow.GetWindowRect())

# crop the bitmap to the dimensions of the worksheet
bitmap = bitmap.Crop(0, 0, ws_width, ws_height)

# save the bitmap as a PNG file in the C:\VS Code\KPI directory
dir_path = r"C:\VS Code\KPI"
if not os.path.exists(dir_path):
    os.makedirs(dir_path)
file_path = os.path.join(dir_path, "worksheet.png")
bitmap.SaveFile(file_path)

# close the workbook and quit Excel
wb.Close(SaveChanges=False)
excel.Quit()
