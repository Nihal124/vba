import win32com.client
import os

def export_screenshot_to_png():
    # Start an instance of Excel
    excel = win32com.client.Dispatch("Excel.Application")

    # Open the workbook
    workbook = excel.Workbooks.Open(r'path\to\your\workbook.xlsx') # replace with your file path

    # Select the sheet
    screenshot_sheet = workbook.Worksheets("Screenshot")

    # Loop over all shapes in the worksheet
    for shape in screenshot_sheet.Shapes:
        export_shape_to_png(shape, screenshot_sheet)

    # Save shape count to main sheet
    workbook.Worksheets("Main").Range("H24").Value = screenshot_sheet.Shapes.Count

    # Cleanup
    excel.Quit()

def export_shape_to_png(shape, sheet):
    # Copy the shape as picture
    shape.CopyPicture()

    # Create a new chart, paste in the picture, and export it
    chart = sheet.ChartObjects().Add(0, 0, shape.Width, shape.Height)
    chart.Chart.Paste()
    chart.Chart.Export(r"C:\DQM-KPI\{}.png".format(shape.Name))
    chart.Delete()

# Run the script
export_screenshot_to_png()
